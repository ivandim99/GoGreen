stages:
- build
- test
- deploy

build:
  stage: build
  script:
  - echo "Building"
  - mkdir build
  - touch build/info.txt
  artifacts:
    paths:
    - build/

test:
  stage: test
  script:
  - echo "Testing"
  - test -f "build/info.txt"
deploy_dev:
    stage: deploy
    environment:
      name: Dev
    image: alpine
    script:
    - apk add --no-cache curl
    - curl -LO $K8S_STABLE_VERSION_URL
    - chmod +x ./kubectl
    - mv ./kubectl /usr/local/bin/kubectl
    - mkdir ~/.kube
    - cp $KUBECONFIG ~/.kube/config
    - cat ~/.kube/config
    - kubectl cluster-info
    # If no error, connection to the cluster from the pipeline script is OK
    # TODO: write a deploy script
    dependencies:
    - test
